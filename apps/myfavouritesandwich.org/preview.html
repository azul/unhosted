<!DOCTYPE html>
<html lang="en" manifest=".appcache">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />

<title>Myfavouritesandwich - An Unhosted demo</title>
<link rel="stylesheet" href="css/uncompressed/reset.css" />
<link rel="stylesheet" href="css/uncompressed/text.css" />
<link rel="stylesheet" href="css/uncompressed/general.css" />
<link rel="stylesheet" href="css/uncompressed/layout.css" />

<script src="socket.io.js"></script>
<script src="https://browserid.org/include.js"></script>
<script src="jquery-1.6.1.min.js"></script>
<script src="base64.js"></script>
<script src="davStorage.js"></script>
<script src="syncStorage.js"></script>
<script src="webfinger.js"></script>
<script src="config.js"></script>
<script>
$(document).ready(function() {
  if (window.location.href != config.appUrl) {
    window.location = config.appUrl
  }
  addEventListener('storage', storage_event, false)
  initSyncStorage(onStatus)
  show()
})

function onStatus( status ){
  document.getElementById('status').innerHTML = status.asHtml;
}

function storage_event(e) {
  if(e.storageArea == null) {//i'm trying to set e.storageArea to window.syncStorage, but it comes out null
    show()
  }
}

function onsave() {
  var sandwich = { ingredients: [ document.getElementById('firstIngredient').value
                                , document.getElementById('secondIngredient').value
                                ]
                 }
  syncStorage.setItem('favSandwich', JSON.stringify(sandwich))
  show()
}

function show() {
  var sandwich
  try {
    sandwich = JSON.parse(syncStorage.getItem('favSandwich'))
  } catch(e) {
    syncStorage.flushItems([ 'favSandwich' ])
  }
  if(!sandwich) {
    sandwich = { ingredients: [ '', '' ] }
  }
  document.getElementById('showFirstIngredient').innerHTML = sandwich.ingredients[0]
  document.getElementById('showSecondIngredient').innerHTML = sandwich.ingredients[1]
  document.getElementById('firstIngredient').value = sandwich.ingredients[0]
  document.getElementById('secondIngredient').value = sandwich.ingredients[1]

  try {
    session = JSON.parse(sessionStorage.getItem('session'))
    ownCloudDetails = session.ownCloudDetails
    document.getElementById('ownCloudForm').action= ownCloudDetails.url
    document.getElementById('ownCloudUser').value= ownCloudDetails.usr
    document.getElementById('ownCloudPassword').value= ownCloudDetails.pwd
    document.getElementById('ownCloudButton').style.display= 'block'
  } catch (e){
    document.getElementById('ownCloudButton').style.display= 'none'
  }
}


</script>
</head>
<body>
<div class="preload"></div>
<div id="preheader"></div>
<div id="plateContainer">
  <figure id="plate"></figure>
</div>
<div id="mainWrap">
  <div id="unlockedView">
    <div id="preheader">
      <span>
        <div id="status">status</div>
		<form id="ownCloudForm" method="post">
			<input type="hidden" name="user" id="ownCloudUser"/>
			<input type="hidden" name="password" id="ownCloudPassword"/>
		        <input type="submit" value="see your data" style="display:none" id="ownCloudButton">
		</form>
	</div>

        <input type="submit" value="Log in with BrowserId" id="loginButton" onclick="syncStorage.signIn()">
        <input type="submit" style="display:none" value="logout" id="logoutButton" onclick="syncStorage.signOut()">
      </span>
    </div>
      
    <header class="data">
      <p>WARNING: We're messing around with stuff <br> so you're likely to get errors right now - come to the <a href="http://webchat.freenode.net/?channels=unhosted">IRC channel</a> if you want to help.</p>
      <p>My favourite sandwich has <strong><span id="showFirstIngredient"></span></strong> and 
        <strong><span id="showSecondIngredient"></span></strong> on it</p>
      <input id="firstIngredient" placeholder='1st ingredient' type="text"/>
      <input id="secondIngredient" placeholder='2nd ingredient' type="text"/>  
      <input class="submitingredients" type="submit" value="Submit!" onclick="onsave()"/>
    </header>
  </div>
  <div id="footerSpacer"></div>          
  <footer>
    <div class="wrapper">
    <div id="leftcolumn">
      <h3>So... what is this all about?</h3>
      <p>
        This is a fictional site that demonstrates the unhosted architecture, a tutorial, so you can take a look at the code to understand how to change this app into something more interesting. View the application source code <a href="https://github.com/unhosted/unhosted" target="_blank">here</a>.
      </p>
      <p>
        <strong>myfavouritesandwich.org is not a commercial website, nor is it affiliated with any trademark</strong>
      </p>
    </div>
    <figure id="island"></figure>
    <div id="rightcolumn">
      <h3>What is Unhosted?</h3>
      <p>
        <strong>Unhosted is a project for strengthening free software against hosted software. 
        </strong>
        An unhosted web app is only source code. Dynamic data is encrypted and decentralised, to per-user storage nodes. This benefits <strong>free software</strong>, as well as <strong>scalability</strong>, <strong>robustness</strong>, and <strong>online privacy</strong>.
      </p>
      <p>
        <strong>Check it out at <a href="http://unhosted.org">unhosted.org</a></strong>
      </p>
    </div>
    <div class="clear">
    </div>        
  </footer>
</div>
</body>
</html>
